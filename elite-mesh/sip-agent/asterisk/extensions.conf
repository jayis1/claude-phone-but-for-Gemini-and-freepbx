[ai-entry]
; Primary entry from FreePBX
exten => s,1,NoOp(AI Agent Incoming Call from PSTN)
 same => n,Set(CALL_ID=${UNIQUEID})
 same => n,Set(NODE=${ENV(NODE_NAME)})
 same => n,UserEvent(CallEvent, State: INIT, Stack: ${NODE}, From: ${CALLERID(num)})
 same => n,Stasis(ai_handler,${CALL_ID})
 same => n,Hangup()

[ai-mesh]
; Inter-AI SIP routing
exten => _[a-z].,1,NoOp(Inter-AI Call received for ${EXTEN})
 same => n,Set(CALL_ID=${UNIQUEID})
 same => n,Set(NODE=${ENV(NODE_NAME)})
 same => n,UserEvent(CallEvent, State: MESH_IN, Stack: ${NODE}, Target: ${EXTEN})
 same => n,Stasis(ai_handler,${CALL_ID})
 same => n,Hangup()

; Standard transfer handler
exten => transfer,1,NoOp(Executing SIP REFER Transfer to ${TARGET})
 same => n,Transfer(PJSIP/${TARGET})
 same => n,Hangup()
